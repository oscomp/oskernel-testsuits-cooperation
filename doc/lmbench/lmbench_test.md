# lmbench 性能测试脚本

## 概述

该 Bash 脚本用于运行一系列基于 `lmbench` 工具的性能测试，`lmbench` 是一个基准测试套件，测量系统级别的性能指标，如系统调用、文件 I/O、进程管理、内存操作等。脚本包含一个函数来比较每个测试的结果与预期结果，并根据预定义的权重计算总得分。

## 主要功能

- **测试环境设置：**
  - 脚本检查是否存在 `lmbench_all` 命令。如果没有找到，它将回退到本地运行测试，而不使用 `lmbench` 套件。
  - 脚本执行一系列测试，包括从系统调用延迟到文件 I/O 性能的多个测试。

- **结果比较：**
  - 脚本将每个测试的实际输出与预期结果进行比较，并根据匹配情况返回得分。
  - 每个测试的得分乘以其分配的权重，以计算最终的总得分。

- **测试分类：**
  - **系统调用**（例如 `lat_syscall_read`、`lat_syscall_write`）
  - **信号处理**（例如 `lat_sig_install`、`lat_sig_catch`）
  - **进程管理**（例如 `lat_proc_fork`、`lat_proc_exec`）
  - **文件和内存 I/O**（例如 `bw_file_rd`、`lat_mmap`）

## 测试详细内容

### 1. 系统调用延迟

- **测试1：** `syscall (null)` 延迟  
  比较空系统调用的延迟性能。

- **测试2：** `syscall (read)` 延迟  
  测量 `read` 系统调用的延迟。

- **测试3：** `syscall (write)` 延迟  
  测量 `write` 系统调用的延迟。

- **测试4-6：** 文件相关系统调用（`stat`、`fstat`、`open`）  
  评估检查文件元数据和打开文件的延迟。

### 2. 信号处理延迟

- **测试8：** 信号处理程序安装延迟  
  测量安装信号处理程序所需的时间。

- **测试9：** 信号捕获延迟  
  测量捕获信号后处理信号所需的时间。

### 3. 进程管理延迟

- **测试12：** `fork` 延迟  
  测量进程 `fork` 所需的时间。

- **测试13：** `exec` 延迟  
  测量进程执行新程序所需的时间。

### 4. 文件和内存 I/O 性能

- **测试15：** 文件写带宽  
  测量写文件的吞吐量。

- **测试17：** 内存映射文件延迟  
  测量内存映射文件的延迟。

- **测试20-23：** 文件和内存读带宽  
  测量读取文件和内存映射数据的吞吐量。

## 评分系统

每个测试都分配了特定的权重，所有权重的总和为 100。最终得分反映了系统在所有测试中的表现。

## 使用方法

1. **运行脚本：**  
   确保安装了必要的工具（如 `lmbench_all` 或 `lmbench` 可执行文件），然后执行脚本开始基准测试。

2. **查看结果：**  
   脚本将输出每个测试的结果及其得分，并在最后输出总得分。

## 示例输出

